#!/bin/bash
# backend setting scriptlet for all environments
#
echo "/// [$(basename $0)-any] Backend settings for $BRAND $ENVIRO $BACKEND ///"

[[ -z $BRAND || -z $ENVIRO || -z $BACKEND ]] && { echo "*** This script is not meant to be run standalone - use 'set-backend' ***"; exit 255; }

cd $TMP/syncappconfig/config || BailOut "<$(basename $0)> Unable to cd to syncappconfig/config"
VALUES=$ENVIRO/values.yaml

Notation "update appsettings for any environment"

# a little macro to improve readability
UPDATE_SETTING="wsi_settings.sh '$COMMENTS' --brand $BRAND --env $ENVIRO -v --bulk"

# MASHERY_SECURED_SERVICE_KEY is captured from the Mashery URL
# eg for we cauat3
# https://williamssonoma.admin.mashery.com/control-center/api-definitions/yd5sns8ppvrhfbrbvrh2n2d5/endpoints/4nrfz386r6kpdsw4cytw5wnb/security-settings 
case $BRAND in
    gr )  INTL_MERCHANT_ID=0000
          MASHERY_SECURED_SERVICE_KEY=
          AFFIRM_API_KEY=NL05W10XIBUFJU6G
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_jyhrwnf3_vcg2nvw36fx452gm
          PARTNER_MPULSE_KEY=LQPPE-E56YY-JP6GD-WA6CW-2EQAT
      ;;
    mg )  INTL_MERCHANT_ID=4085
          MASHERY_SECURED_SERVICE_KEY=bw9pryzfzkmt3q8j5fzdjd97
          AFFIRM_API_KEY=JQ8M0CRVFOMHH59R
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_dkghb6bs_8s2vsv93tjbfvcnw
          PARTNER_MPULSE_KEY=L9HRL-N5628-HF3UW-HX4F6-RW99Q
      ;;
    pb )  INTL_MERCHANT_ID=2686
          MASHERY_SECURED_SERVICE_KEY=e33269rtb72wgegv72wq5cg4
          [[ $MARKET = "CAN" ]] && MASHERY_SECURED_SERVICE_KEY=e33269rtb72wgegv72wq5cg4
          AFFIRM_API_KEY=NL05W10XIBUFJU6G
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_pfpkhzgr_kzjjq77zw8wkxwk9
          PARTNER_MPULSE_KEY=HW4CW-LJJEA-M97XN-QJXWX-3MWFX
      ;;
    pk )  INTL_MERCHANT_ID=2687
          MASHERY_SECURED_SERVICE_KEY=w8qjfpz9hg7zbkfxxw93ew9g
          [[ $MARKET = "CAN" ]] && MASHERY_SECURED_SERVICE_KEY=w8qjfpz9hg7zbkfxxw93ew9g
          MASHERY_API_KEY=hzn5zw3bckug864vf9skem9v
          AFFIRM_API_KEY=9FEREFZ81YNS0JWU
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_qtnmx4sd_qxdxfzrs4xh6957t
          PARTNER_MPULSE_KEY=AFZ2Z-ZSXBY-Q6KFG-QAPMK-PHJXP
      ;;
    pt )  INTL_MERCHANT_ID=2688
          MASHERY_SECURED_SERVICE_KEY=vnehbg3aqzapeu63zzcd2ky6
          #[[ $MARKET = "CAN" ]] && MASHERY_SECURED_SERVICE_KEY=
          AFFIRM_API_KEY=YT5OK3VRLWZMENIC
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_g5jqqbmr_d7ttrkn7swhtcr69
          PARTNER_MPULSE_KEY=5X59H-6HBXE-N7UAZ-MQSWN-P7W78
      ;;
    rj )  INTL_MERCHANT_ID=0000
          MASHERY_SECURED_SERVICE_KEY=
          AFFIRM_API_KEY=NL05W10XIBUFJU6G
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_s99kkk2r_z4bj8ycq87p9nwmm
          PARTNER_MPULSE_KEY=5EPWF-776K5-BE4JH-2TVZ3-EBAQT
      ;;
    we )  INTL_MERCHANT_ID=2690
          MASHERY_SECURED_SERVICE_KEY=yd5sns8ppvrhfbrbvrh2n2d5
          [[ $MARKET = "CAN" ]] && MASHERY_SECURED_SERVICE_KEY=yd5sns8ppvrhfbrbvrh2n2d5
          AFFIRM_API_KEY=CA9T4AF2OM8ZV27H
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_vcrm3mp6_nwx69d2zjb6mydk9
          PARTNER_MPULSE_KEY=ZZ8PE-BVGTK-HKD5Y-WGX6Q-6BSB7
      ;;
    ws )  INTL_MERCHANT_ID=2689
          MASHERY_SECURED_SERVICE_KEY=844xkmugpjcf6s29e2376u6z
          [[ $MARKET = "CAN" ]] && MASHERY_SECURED_SERVICE_KEY=844xkmugpjcf6s29e2376u6z
          AFFIRM_API_KEY=U2NJ7FOOK0LUU14L
          BRAINTREE_ACCOUNT_TOKENIZATION_KEY=sandbox_fm86bpdt_c65fyn8nnpw9d3c4
          PARTNER_MPULSE_KEY=3AQ56-C8PNB-MLCR5-X4E5J-KUB44
      ;;
esac

# these are brand-specific settings
$UPDATE_SETTING AFFIRM.API_KEY.s=$AFFIRM_API_KEY
$UPDATE_SETTING BRAINTREE.ACCOUNT_TOKENIZATION_KEY.s=$BRAINTREE_ACCOUNT_TOKENIZATION_KEY

[[ -n $MASHERY_SECURED_SERVICE_KEY ]] && $UPDATE_SETTING PROFILE.MASHERY_SECURED_SERVICE_KEY.s=$MASHERY_SECURED_SERVICE_KEY
[[ -n $MASHERY_SECURED_SERVICE_KEY ]] && $UPDATE_SETTING ECOMSERV.MASHERY_SECURED_SERVICE_KEY.s=$MASHERY_SECURED_SERVICE_KEY
[[ -n $MASHERY_API_KEY ]] && $UPDATE_SETTING PROFILE.MASHERY_API_KEY.s=$MASHERY_API_KEY
[[ -n $MASHERY_API_KEY ]] && $UPDATE_SETTING ECOMSERV.MASHERY_API_KEY.s=$MASHERY_API_KEY

[[ -n $PARTNER_MPULSE_KEY ]] && $UPDATE_SETTING PARTNER.MPULSE_KEY.s=$PARTNER_MPULSE_KEY

# this is the minimum list of settings for DP to start
#set -x

for tld in ae au ca kr kw mx ph 
do
  domain=$(get-domain $BRAND | awk -F\. '{ print $1 }')
  CODE=$(tr '[:lower:]' '[:upper:]' <<< $tld)
  INTERNATIONAL_VISITOR_REDIRECT_COUNTRY_MAP="$CODE=http://www.$domain.$tld/,$INTERNATIONAL_VISITOR_REDIRECT_COUNTRY_MAP"
  CROSS_BRAND_BASE_URLS="$CODE=$AKAMAI:$CROSS_BRAND_BASE_URLS"
done
INTERNATIONAL_VISITOR_REDIRECT_COUNTRY_MAP=$(sed -es/,$//g <<< $INTERNATIONAL_VISITOR_REDIRECT_COUNTRY_MAP)
CROSS_BRAND_BASE_URLS=$(sed -es/,$//g <<< $CROSS_BRAND_BASE_URLS)
$UPDATE_SETTING "CROSS_BRAND.BASE_URLS.p=$CROSS_BRAND_BASE_URLS"

#$UPDATE_SETTING AB_TESTS.PROXY_ENDPOINT_URI.r=https://ecommerce-experiment-proxy-${REALM}.services.west.nonprod.wsgc.com/experimentation/v1/environments/${ENVIRO_UC}/concepts/${BRAND_UC}/schedule

if [[ $ENVIRO =~ int ]]
then
  $UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.DOMAIN_PUBLISHER_GROUP_NAME.s=${BRAND}-qa
fi

if [[ $ENVIRO =~ rgs ]]
then
  $UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.DOMAIN_PUBLISHER_GROUP_NAME.s=${BRAND}-qa
fi

if [[ $ENVIRO =~ qa ]]
then
  $UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.DOMAIN_PUBLISHER_GROUP_NAME.s=${BRAND}-qa
fi

if [[ $ENVIRO =~ uat || $ENVIRO =~ bpv ]]
then
  $UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.DOMAIN_PUBLISHER_GROUP_NAME.s=${BRAND}-uat3
fi

$UPDATE_SETTING PARTNER.PORCH_DOMAIN.s=api.qa.porch.com

$UPDATE_SETTING BLMREACH.DOMAIN.s=$AKAMAI

$UPDATE_SETTING PAYMENT.TOKENIZATION_HTTPS_ENABLED.b=true

$UPDATE_SETTING CHKT.SINGLE_PAGE_CHECKOUT_ENABLED.b=true

$UPDATE_SETTING INVENTORY_OMS_RESERVATION_REST.TRANSPORT.s=REST
$UPDATE_SETTING INVENTORY_OMS_RESERVATION_REST.SOCKET_TIMEOUT.i=10000
$UPDATE_SETTING INVENTORY_OMS_RESERVATION_REST.SEND_MARKET_IN_REQUEST.b=true
$UPDATE_SETTING INVENTORY_OMS_RESERVATION_REST.ECOM_TO_ECDD_ENDPOINT.s=V4/ECOMToSterlingECDDService
$UPDATE_SETTING INVENTORY_OMS_REST.TRANSPORT.s=REST
$UPDATE_SETTING INVENTORY_OMS_REST.REST_RETRY_MAX.i=15
$UPDATE_SETTING INVENTORY_OMS_REST.RETRY_COUNT.i=10
$UPDATE_SETTING INVENTORY_OMS_REST.SOCKET_TIMEOUT.i=15000
$UPDATE_SETTING INVENTORY_OMS_REST.ECOM_TO_ATP_ENDPOINT.s=v2/ECOMMToSterlingATPFindInventory

$UPDATE_SETTING LOYALTY.KAFKA_PRODUCER_BOOTSTRAP_SERVERS.s=rk.qa.kafka.int.wsgc.com:443

$UPDATE_SETTING INTL.51ENABLED.b=true
$UPDATE_SETTING INTL.MERCHANT_ID.s=$INTL_MERCHANT_ID
$UPDATE_SETTING INTL.INTERNATIONAL_VISITOR_REDIRECT_COUNTRY_MAP.p=$INTERNATIONAL_VISITOR_REDIRECT_COUNTRY_MAP
$UPDATE_SETTING INTL.SHIP_TO_LIST.a=intl51,intl51furniture
$UPDATE_SETTING INTL.FURNITURE_SHIP_TO.s=intl51furniture
$UPDATE_SETTING INTL.FURNITURE_SHIP_ELIGIBLE_COUNTRY_LIST.a=CA
$UPDATE_SETTING INTL.FURNITURE_SHIPPING_ENABLED.b=true
$UPDATE_SETTING INTL.FURNITURE_ELIGIBLE_ORDER_OVERFLOW_THRESHOLD.n=25000

$UPDATE_SETTING INTL.ENVOY_JS_URL.s=https://global.sbx.borderfree.com/cdn/checkout/v5/dist/envoy.js
$UPDATE_SETTING INTL.INTER_TRACKING_EXT_SERVICE.s=https://global.sbx.borderfree.com/trackingapi/flex/tracking/tracking.swf
$UPDATE_SETTING INTL.MERCHANT_JS_DOMAIN.s=global.sbx.borderfree.com

$UPDATE_SETTING C3_CONF_CONNECT.SERVICE_URI.r=https://ecommerce-c3-qa1.services.west.nonprod.wsgc.com

$UPDATE_SETTING COMCAT.LOWSPECIAL.n=0.95
$UPDATE_SETTING COMCAT.HIGHSPECIAL.n=100

$UPDATE_SETTING COMAVS.AVS_REST_SERVICE_URL.s=https://ecommerce-avs-service-${REALM}.services.west.nonprod.wsgc.com/address-verification-service/v1/

$UPDATE_SETTING AFFIRM.AFFIRM_AB_VARIATIONS.a=test
$UPDATE_SETTING AFFIRM.SCRIPT_URL.s=https://cdn1-sandbox.affirm.com/js/v2/affirm.js
$UPDATE_SETTING AFFIRM.STORE_CHECKOUT_URL.r=https://sandbox.affirm.com/api/v2/checkout/store

$UPDATE_SETTING  INVENTORY.NON_FN_TRANSIT_SCHEDULE.p=MONDAY=true,TUESDAY=true,WEDNESDAY=true,THURSDAY=false,FRIDAY=true,SATURDAY=false,SUNDAY=false

# don't know if this needs an env or not

#wsi_settings.sh --brand $BRAND --env $ENVIRO -v --bulk BRAND_CREDIT_CARD.REWARD_SUMMARY_SERVICE_URL.r=https://enterprise-credit-card-orchestration-uat.services.west.nonprod.wsgc.com/creditcard-orchestration/v1/loyaltyCards/rewardSummary/COF/
$UPDATE_SETTING BRAND_CREDIT_CARD.CREDIT_CARD_PRE_ENROLLMENT_URL.s=https://enterprise-credit-card-orchestration-develop.services.west.nonprod.wsgc.com/creditcard-orchestration/v1/card-application/pre-enrollment
$UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.DOMAIN_PUBLISHER_URL.s=https://search-publisher-${REALM}-rk1v.wsgc.com/v1/domains/
#$UPDATE_SETTING LOYALTY.ELS_CARD_ENDPOINT_URL.r=https://loyalty-${REALM}1-rk1v.wsgc.com/loyalty/v1/loyaltyCards
$UPDATE_SETTING LOYALTY.ELS_CARD_ENDPOINT_URL.r=https://loyalty-${REALM}.wsgc.com/loyalty/v1/loyaltyCards
$UPDATE_SETTING LOYALTY.ELS_ENDPOINT_URL.s=https://loyalty-${REALM}.wsgc.com/loyalty/v1/loyaltyAccounts

$UPDATE_SETTING PRICING.PROMOTION_ELIGIBILITY_EXCLUDE_NLA.b=true
$UPDATE_SETTING PRICING.PROMOTION_ELIGIBILITY_THROTTLE_ENABLED.b=true
$UPDATE_SETTING PRICING.PROMOTION_POPULATE_CACHE_TIMEOUT.i=200
$UPDATE_SETTING PRICING.PROMOTION_RELATED_PRODUCTS_ENABLED.b=true
$UPDATE_SETTING PRICING.PROMOTION_THREAD_POOL_MAX_SIZE.i=200
$UPDATE_SETTING PRICING.PROMOTION_THREAD_POOL_QUEUE_SIZE.i=100
$UPDATE_SETTING PRICING.PROMOTION_THREAD_POOL_SIZE.i=200
$UPDATE_SETTING PRICING.PROMOTION_VISIBILITY_PIP_ENABLED.b=true
$UPDATE_SETTING PRICING.PROMO_VISIBILITY_SUBSET_ENABLED.b=true
$UPDATE_SETTING PRICING.TRANSPORT.s=REST

$UPDATE_SETTING GUIDED_PIP.RECENTLY_VIEWED_SWATCHES_ENABLED.b=true
$UPDATE_SETTING RECOMMENDATION.RVI_API_URL.s=catalog/\${productOrSkuId}/widget.json
$UPDATE_SETTING TRENDING_PRODUCTS.API_URL.s=$AKAMAI/svc/recommendation/v1
$UPDATE_SETTING URGENCY_MESSAGING_PIP.URGENCY_API_URL.s=$AKAMAI/svc/recommendation/v1
$UPDATE_SETTING RECENTLY_VIEWED_ITEMS.RECOMMENDATION_API_URL.s=$AKAMAI/svc/recommendation/v1
$UPDATE_SETTING RECOMMENDATION.RECOMMENDATION_API_URL.s=$AKAMAI/svc/recommendation/v1

$UPDATE_SETTING COMREG.REGCOOKIENAME.s=${BRAND_UC}4REGQA
$UPDATE_SETTING COMREG.REG_STS_COOKIENAME.s=${BRAND_UC}MX_REGSTS_QA

$UPDATE_SETTING AB_TESTS.PROXY_ENDPOINT_URI.r=https://ecommerce-experiment-proxy-${REALM}.services.west.nonprod.wsgc.com/experimentation/v1/environments/concepts/${BRAND_UC}/schedule

$UPDATE_SETTING TRENDING_PRODUCTS.API_URL.s=https://www.uat3.westelm.com/svc/recommendation/v1

$UPDATE_SETTING ECOMSERV.STORE_ESTIMATE_SERVICE_URI.r=http://ssprck-vdwn008.wsgcdev.local:9006/UIScom/api/v1/estimate/


$UPDATE_SETTING SERVICEHEALTH.AVAIL_NOTIFICATION_WAIT_TIME.i=900000

$UPDATE_SETTING COMCRT.LIFETIME.i=30
$UPDATE_SETTING COMCRT.DATALIFETIME.t=31,0,0,0
$UPDATE_SETTING COMCRT.MINCLEANUPTIME.t=0,0,10,0
$UPDATE_SETTING COMCRT.SAVEDCARTDATATABLE.s=${BRAND_UC}_SAVEDCART_DATA
$UPDATE_SETTING COMCRT.SAVEDCARTINFOTABLE.s=${BRAND_UC}_SAVEDCART_INFO
$UPDATE_SETTING COMCRT.MAXSESSIONTIME.t=1,1,0,0

$UPDATE_SETTING COMPRF.PERSISTENT_METRICS_COOKIE.s=${BRAND_UC}_PCMETRICS_COOKIE_QA
$UPDATE_SETTING COMPRF.PRF_COOKIENAME.s=${BRAND_UC}MX_SIGNIN_QA
$UPDATE_SETTING COMPRF.USER_PERSIST_COOKIE_NAME.s=${BRAND_UC}MX_PERSIST_COOKIE_QA
$UPDATE_SETTING COMPRF.ACCT_COOKIENAME.s=${BRAND_UC}MX_ACCT_QA
$UPDATE_SETTING COMPRF.TEXT_ME_OFFERS_ENABLED.b=false

$UPDATE_SETTING COMPRF.LITE_ACCOUNT_ENABLED.b=true

#$UPDATE_SETTING COMEXP.EXPRESS_CHECKOUT_ENABLED.b=true
$UPDATE_SETTING COMEXP.EXPRESS_CHECKOUT_ENABLED.i=0
$UPDATE_SETTING COMEXP.EXPRESS_CHECKOUT_COOKIE.s=${BRAND_UC}EXPRESS_CHECKOUT_${REALM}

$UPDATE_SETTING BIZSALES.BIZSALESAUTH_URL.s=https://ecommerce-salesforceconnector-${REALM}.services.west.nonprod.wsgc.com/designer-servlet


#$UPDATE_SETTING 'DESIGN_CHAT.CHAT_VENDOR_API_URL.s=https://westelm.quiq-api.com/app/webchat/index.js'
$UPDATE_SETTING 'DESIGN_CHAT.CHAT_VENDOR_API_URL.s=https://wsi-stage.quiq-api.com/app/webchat/index.js'
$UPDATE_SETTING 'DESIGN_CHAT.URL_PREFIX_LIST.m=/.*,/m/.*'
$UPDATE_SETTING 'DESIGN_CHAT.EXCLUDED_URL_PREFIX_LIST.m=/checkout/.*,/shoppingcart/.*,/m/checkout/.*,/m/shoppingcart/.*,/admin/.*'

$UPDATE_SETTING ACCOUNT_SERVICES.OAUTH_AUTHORIZATION_TOKEN_URL.s=https://ecommerce-oauth-${REALM}.services.west.nonprod.wsgc.com/oauth/authorize
$UPDATE_SETTING ACCOUNT_SERVICES.OAUTH_CHECK_TOKEN_URI.s=https://ecommerce-oauth-${REALM}.services.west.nonprod.wsgc.com/oauth/check_token
$UPDATE_SETTING ACCOUNT_SERVICES.USER_SERVICE_URI.s=https://ecommerce-oauth-${REALM}.services.west.nonprod.wsgc.com/v1/users
$UPDATE_SETTING ACCOUNT_SERVICES.VERIFICATION_SERVICE_URL.r=https://ecommerce-profile-${REALM}1.services.west.nonprod.wsgc.com/v2/verification/
$UPDATE_SETTING ACCOUNT_SERVICES.PROFILE_SERVICE_URL.r=https://ecommerce-profile-${REALM}1.services.west.nonprod.wsgc.com/v2/profiles
$UPDATE_SETTING ACCOUNT_SERVICES.LINK_CLIENT_ID.s=mashery_${BRAND_UC}/${REALM}
$UPDATE_SETTING ACCOUNT_SERVICES.IS_PERSISTENT_LOGIN_ENABLED.b=true
$UPDATE_SETTING ACCOUNT_SERVICES.STANDARD_LOGIN_COOKIE_NAME.s=${BRAND_UC}_SLID
$UPDATE_SETTING ACCOUNT_SERVICES.STANDARD_LOGIN_SESSION_LIFETIME_TTL.t=0,2,0,0,0
$UPDATE_SETTING ACCOUNT_SERVICES.LOGIN_ATTEMPT_LIMIT.i=2
$UPDATE_SETTING ACCOUNT_SERVICES.TIME_ZONE.s=PST
$UPDATE_SETTING ACCOUNT_SERVICES.IS_STANDARD_LOGIN_COOKIE_ENABLED.b=true

$UPDATE_SETTING COMPRF.ACCT_EMAIL_LOGO_LARGE.s=https://www.$(getdomain $BRAND $ENVIRO)/netstorage/images/${BRAND}_logo_lg.gif
$UPDATE_SETTING COMPRF.ACCT_EMAIL_LOGO_SMALL.s=https://www.$(getdomain $BRAND $ENVIRO)/netstorage/images/${BRAND}_logo_sm.gif

$UPDATE_SETTING RICHREL.URL.s=//integration.richrelevance.com/rrserver/
$UPDATE_SETTING RICHREL.ENABLED.b=false
$UPDATE_SETTING RICHREL.PIPRVI_ENABLED.b=false
$UPDATE_SETTING RICHREL.MOBILE_CART_ENABLED.b=false
$UPDATE_SETTING RICHREL.MOBILE_PIP_ENABLED.b=false
$UPDATE_SETTING RICHREL.MOBILE_RAC_RR_ENABLED.b=false
$UPDATE_SETTING RICHREL.MYRECS_ENABLED.b=false
$UPDATE_SETTING RICHREL.PINIT_ENABLED.b=false

$UPDATE_SETTING CONTPERS.CRE_CP_ENABLED.b=true
$UPDATE_SETTING CONTPERS.CRE_PROFILE_COOKIE_LIST.s=CoreID6,wsiakid,svi_dec
$UPDATE_SETTING CONTPERS.CRE_SERVICES_BASIC_URL.s=qamatch.collectandgather.com
$UPDATE_SETTING CONTPERS.EMAIL_ADDTL_OPTIONS_ENABLED.b=true
$UPDATE_SETTING CONTPERS.EMAIL_CAPTURE_EXPERIENCE.s=Overlay
$UPDATE_SETTING CONTPERS.IE_11_OVERLAY_ENABLED.b=true
$UPDATE_SETTING CONTPERS.TRACK_IMPRESSIONS.b=false

$UPDATE_SETTING MEMBERSHIP_SERVICE.SERVICE_URI.r=https://enterprise-membership-service-${REALM}.services.west.nonprod.wsgc.com/membership/v1/members
$UPDATE_SETTING AB_TESTS.GLOBAL_AB_TESTS_ENABLED.b=false
#$UPDATE_SETTING "AB_TESTS.COOKIE_EXPIRES.s=Mon, 01 Jan 2024 00:00:01 GMT"
#$UPDATE_SETTING AB_TESTS.AB_TEST_EXPERIENCES.h=categoryrankings=bloomreach|control

$UPDATE_SETTING PLATFORM_SESSION_SERVICE.SERVICE_URI.r=https://edap-platform-svc-session-${REALM}.services.west.nonprod.wsgc.com/session-service/v1/session
$UPDATE_SETTING PLATFORM_SESSION_SERVICE.PLATFORM_SID_COOKIENAME.s=${BRAND_UC}_SID
$UPDATE_SETTING PLATFORM_SESSION_SERVICE.PLATFORM_PROVISIONAL_SID_COOKIENAME.s=${BRAND_UC}_PSID
$UPDATE_SETTING PLATFORM_SESSION_SERVICE.CONNECTION_ACQUISITION_TIMEOUT.i=9000

$UPDATE_SETTING COMSES.DATATABLE.s=${BRAND_UC}PE_SESSION_DATA
$UPDATE_SETTING COMSES.INFOTABLE.s=${BRAND_UC}PE_SESSION_INFO
$UPDATE_SETTING COMSES.LIFETIME.t=0,0,5,0
$UPDATE_SETTING COMSES.SCANTIME.t=0,0,0,30
$UPDATE_SETTING COMSES.CACHETIME.t=0,0,5,0
$UPDATE_SETTING COMSES.MAXCACHE.i=5000
$UPDATE_SETTING COMSES.MAX_LENGTH.t=0,0,5,0

$UPDATE_SETTING WISMO.DESKTOP_REQUEST_TIMEOUT.t=0,0,0,30
$UPDATE_SETTING INVENTORY.INVENTORY_CHECK_TIMEOUT_IN_SECONDS.t=0,0,0,7
$UPDATE_SETTING FAVORITES.SERVICE_URL.s=https://ecommerce-favorites-${REALM}.services.west.nonprod.wsgc.com/favorites/v3

$UPDATE_SETTING ECM.ECM_HOMEPAGE_ENABLED.b=true

$UPDATE_SETTING INVENTORY_OMS_RESERVATION_REST.CONNECTION_ACQUISITION_TIMEOUT.i=20000

$UPDATE_SETTING OMS.ORDER_PRICING_RECEIVE_TIMEOUT.i=9000
$UPDATE_SETTING OMS.INVENTORY_RESERVATION_RECEIVE_TIMEOUT.i=60000
$UPDATE_SETTING OMS.ORDER_PRICING_TIMEOUT.i=20000
$UPDATE_SETTING OMS.PROMOTION_ELIGIBILITY_RECEIVE_TIMEOUT.i=20000
$UPDATE_SETTING OMS.INVENTORY_RESERVATION_RECEIVE_TIMEOUT.i=20000
$UPDATE_SETTING OMS.INVENTORY_RESERVATION_REQUEST_REFRESH_TIME.t=0,0,30,0
$UPDATE_SETTING OMS.FINAL_REPUBLISH_INTERVAL.i=43200
$UPDATE_SETTING OMS.DC_PICKUP_LOCATIO.s=DC/MEMPHIS

$UPDATE_SETTING ORDERNUMBERSERVICE.FETCH_SIZE.i=1000
$UPDATE_SETTING ORDERNUMBERSERVICE.SYSTEM_ID.s=1
$UPDATE_SETTING ORDERNUMBERSERVICE.PREFIX.s=9

$UPDATE_SETTING BRAND_CREDIT_CARD.REWARDS_TERMS_AND_CONDITIONS_URL.r=https://retailuat1.alldata.net/williamssonomavisa/common/legal/RewardsTermsAndConditionsDisclosure.xhtml
$UPDATE_SETTING BRAND_CREDIT_CARD.PRESCREEN_URL.r=https://retailuat.alldata.net:443/axes103/web-services/olps4x
$UPDATE_SETTING BRAND_CREDIT_CARD.PRESCREEN_CREDIT_REQUEST_URL.s=https://cuat.comenity.net/{0}/pub/apply/Prescreen.xhtml
$UPDATE_SETTING BRAND_CREDIT_CARD.CREDIT_ORCHESTRATION_PRESCREEN_URL.s=https://enterprise-credit-card-orchestration-develop.services.west.nonprod.wsgc.com/creditcard-orchestration/v1/prescreen/offer-eligibility
$UPDATE_SETTING BRAND_CREDIT_CARD.INSTANT_CREDIT_REQUEST_URL.s=https://cuat.comenity.net/{0}/public/apply/Apply.xhtml
$UPDATE_SETTING BRAND_CREDIT_CARD.MADE_OFFER_URL.r=https://retailuat.alldata.net:443/axes103/web-services/madeOffer4x
$UPDATE_SETTING BRAND_CREDIT_CARD.VCN_CREDIT_ORCHESTRATION_LINKING_URL.s=https://enterprise-credit-card-orchestration-$REALM.services.west.nonprod.wsgc.com/creditcard-orchestration/v1/link/virtual-card
$UPDATE_SETTING BRAND_CREDIT_CARD.CREDIT_ORCHESTRATION_LINKING_URL.s=https://enterprise-credit-card-orchestration-$REALM/creditcard-orchestration/v1/link/partner-accounts

$UPDATE_SETTING PLCC.CBCC_ENABLED.b=false
$UPDATE_SETTING PLCC.CBCC_PRESCREEN_CREDIT_REQUEST_URL.s=https://cuat.comenity.net/{0}/public/apply/Prescreen.xhtml
$UPDATE_SETTING PLCC.PLCC_AB_TEST_ENABLED.b=true
$UPDATE_SETTING PLCC.PLCC_CLIENT_NAME.s=$DOMAIN
$UPDATE_SETTING PLCC.PLCC_CREDITCARD_TERMS_AND_CONDITIONS_URL.s=https://retailuat1.alldata.net/williamssonomavisa/common/Legal/disclosures.xhtml
$UPDATE_SETTING PLCC.PLCC_ENABLED.b=true
$UPDATE_SETTING PLCC.PLCC_ENROLLMENT_MBOX_NAME.s=${BRAND}-plcc-enrollment
$UPDATE_SETTING PLCC.PLCC_MADEOFFER_URL.s=https://retailuat.alldata.net:443/axes103/web-services/madeOffer4x
$UPDATE_SETTING PLCC.PLCC_PRESCREEN_COOKIE_TTL_IN_HOURS.i=24
$UPDATE_SETTING PLCC.PLCC_PRESCREEN_CREDIT_REQUEST_URL.s=https://cuat.comenity.net/{0}/public/apply/Prescreen.xhtml
$UPDATE_SETTING PLCC.PLCC_PRESCREEN_URL.s=https://retailuat.alldata.net:443/axes103/web-services/olps4x
$UPDATE_SETTING PLCC.PLCC_REWARDS_TERMS_AND_CONDITIONS_URL.s=https://retailuat1.alldata.net/williamssonomavisa/common/legal/RewardsTermsAndConditionsDisclosure.xhtml
$UPDATE_SETTING PLCC.PLCC_SECURITY_BUNDLE_ID.s=wsgcqa052017
$UPDATE_SETTING PLCC.PLCC_SPLIT_MBOX_NAME.s=${BRAND}-plcc-assignment
$UPDATE_SETTING PLCC.PRESCREEN_CREDIT_REQUEST_URL.s=https://cuat.comenity.net/{0}/public/apply/Prescreen.xhtml
$UPDATE_SETTING PLCC.SOCKET_TIMEOUT.i=9000

$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_POSTAL_CODE_DISPLAY_FORMAT_FIND_REPLACE_MAP.p=US=[^\d]=,CA=...(?!$)=$0'
$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_POSTAL_CODE_DISPLAY_VALIDATION_REGEX_MAP.p=US=/^([0-9]{5}|[0-9]{5}-[0-9]{4})$/,CA=/^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z] [0-9][a-zA-Z][0-9]$/'
$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_POSTAL_CODE_MAX_LENGTH_MAP.p=US=7,CA=7'
$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_POSTAL_CODE_MIN_LENGTH_MAP.p=US=5,CA=6'
$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_POSTAL_CODE_VALIDATION_REGEX_MAP.p=US=^[0-9]{5}$,CA=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z][0-9][a-zA-Z][0-9]$'
$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_REDACTED_POSTAL_CODE_VALIDATION_REGEX_MAP.p=US=^[0-9]{5}$,CA=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z]$'

$UPDATE_SETTING 'GEO_LOCATION.COUNTRY_SANITIZE_POSTAL_CODE_REGEX_MAP.p=US=[^\\d],CA=\\s+'
#Using the adhoc tool requires escaping backwards slashes, so the value needs to be entered as “US=[^\\\\d],CA=\\\\s+” in the Jenkins self-service adhoc settings job.

{ set +x; } 2>/dev/null

if [[ $MARKET = "CAN" ]]
then
  echo "* update $MARKET-specific settings"
#set -x

  $UPDATE_SETTING SEARCH.BLOOMREACH_SEARCH_URL.r=https://core.dxpapi.com/api/v1/core/
  $UPDATE_SETTING BRAINTREE_ACCOUNT.MERCHANT_ACCOUNT_ID.s=${BRAND_UC}_CAD
  $UPDATE_SETTING 'DELIVERY_ESTIMATE.POSTAL_CODE_VALIDATION_REGEX.s=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z][0-9][a-zA-Z][0-9]$'
  $UPDATE_SETTING 'RESERVATION_CHOICE_REQUEST.POSTAL_CODE_MIN_LENGTHS.a=USA=5,CA=6'
  $UPDATE_SETTING PIP.FULFILLMENT_COUNTRY_CODE.a=CA
  $UPDATE_SETTING ABANDONED_ORDER.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING CANCEL_RESERVATION.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING INVENTORY.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING INVENTORY_OMS_RESERVATION_REST.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING ORDER_CREATE.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING ORDER_SCREENING.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING PAYMENT.SEND_MARKET_IN_REQUEST.b=true
  $UPDATE_SETTING TEALIUM.LIBRARY_PATH.s=wsi/ca-all-brands/qa
  $UPDATE_SETTING 'DELIVERY_ESTIMATE.POSTAL_CODE_VALIDATION_REGEX.s=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z][0-9][a-zA-Z][0-9]$'

  $UPDATE_SETTING 'PRICING.DEFAULT_ADDRESS_FOR_PREVIEW_PRICING_REQUEST.p=state_province=BC,city=Brentwood Bay,postal_code=000000'
  $UPDATE_SETTING 'PRICING.SEND_MARKET_IN_REQUEST.b=true'

  $UPDATE_SETTING 'GEO_LOCATION.POSTAL_CODE_MIN_LENGTH.i=6'
  $UPDATE_SETTING 'GEO_PROVINCES_API.STATES_PROVINCES_URL.s=https://ecommerce-ecom-svc-customer-uat.services.west.nonprod.wsgc.com/api/geo/v1/provinces.json'
  $UPDATE_SETTING 'GEO_LOCATION.SANITIZE_POSTAL_CODE_REGEX.s=\\\s+'
  $UPDATE_SETTING 'GEO_LOCATION.POSTAL_CODE_DISPLAY_VALIDATION_REGEX.s=/^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z] [0-9][a-zA-Z][0-9]$/'
  $UPDATE_SETTING 'GEO_LOCATION.POSTAL_CODE_VALIDATION_REGEX.s=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z][0-9][a-zA-Z][0-9]$'
  $UPDATE_SETTING 'GEO_LOCATION.REDACTED_POSTAL_CODE_VALIDATION_REGEX.s=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z]$'
  $UPDATE_SETTING 'GEO_LOCATION.POSTAL_CODE_DISPLAY_VALIDATION_REGEX.s=/^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z] [0-9][a-zA-Z][0-9]$/'
  $UPDATE_SETTING 'GEO_LOCATION.POSTAL_CODE_DISPLAY_FORMAT_FIND_REPLACE.s=...(?!$)=$0'
  $UPDATE_SETTING 'GEO_LOCATION.POSTAL_CODE_VALIDATION_REGEX.s=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z][0-9][a-zA-Z][0-9]$'
  $UPDATE_SETTING 'GEO_LOCATION.REDACTED_POSTAL_CODE_VALIDATION_REGEX.s=^(?!.*[dfioquDFIOQU])[aA-vxyzwVXY][0-9][a-zA-Z]$'

  $UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.DOMAIN_PUBLISHER_GROUP_NAME.s=${BRAND}-ca-qa
  $UPDATE_SETTING DOMAIN_PUBLISHER_CLIENT.PUBLISHER_OVERRIDE_KEY.s=${DOMAIN}_ca
  $UPDATE_SETTING REDUCED_PIP.EXTERNAL_TRAFFIC_EXCLUDED_REFERER_VALUES.m=localhost,${DOMAIN}.com,${DOMAIN}.ca

  case $BRAND in
    gr ) BLOOMREACH_ACCOUNT_ID=7170 ;;
    mg ) BLOOMREACH_ACCOUNT_ID=6169 ;;
    pb ) BLOOMREACH_ACCOUNT_ID=6533 ;;
    pk ) BLOOMREACH_ACCOUNT_ID=6534 ;;
    pt ) BLOOMREACH_ACCOUNT_ID=6741 ;;
    rj ) BLOOMREACH_ACCOUNT_ID=6157 ;;
    we ) BLOOMREACH_ACCOUNT_ID=6535 ;;
    ws ) BLOOMREACH_ACCOUNT_ID=6532 ;;
  esac
  $UPDATE_SETTING SEARCH.BLOOMREACH_ACCOUNT_ID.s=$BLOOMREACH_ACCOUNT_ID

{ set +x; } 2>/dev/null
fi

# leave this "echo" here - we need a clean exit code from this script
echo

